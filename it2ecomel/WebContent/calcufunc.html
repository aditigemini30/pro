<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Eco-Melbourne</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

    <!-- Plugin CSS -->
    <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/creative.min.css" rel="stylesheet">
        <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<style>

      #description {
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
      }

      #infowindow-content .title {
        font-weight: bold;
      }

      #infowindow-content {
        display: none;
      }

      #map #infowindow-content {
        display: inline;
      }

      .pac-card {
        margin: 10px 10px 0 0;
        border-radius: 2px 0 0 2px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        outline: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        background-color: #fff;
        font-family: Roboto;
      }

      #pac-container {
        padding-bottom: 12px;
        margin-right: 12px;
      }

      .pac-controls {
        display: inline-block;
        padding: 5px 11px;
      }

      .pac-controls label {
        font-family: Roboto;
        font-size: 13px;
        font-weight: 300;
      }

      #pac-input {
        background-color: #fff;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        margin-left: 12px;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 400px;
      }

      #pac-input:focus {
        border-color: #4d90fe;
      }

      #title {
        color: #fff;
        background-color: #4d90fe;
        font-size: 25px;
        font-weight: 500;
        padding: 6px 12px;
      }
      #target {
        width: 345px;
      }
</style>
  </head>

  <body id="page-top">

<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="index.html">Eco Melbourne</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="index.html">Home</a>
            </li>
            <li class="nav-item">
            	 <a class="nav-link js-scroll-trigger" href="data.html">Statistics</a>

            </li>
            
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="calculator.html">Footprint Calculator</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="bikeintro.html">Find-bike</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="about.html">About Us</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>


    <header class="header3">
      <div class="container my-auto">
       
      </div>
    </header>
  <section style="width: 100%;height: 93%;">
  	<div class="container"style="width: 100%;height: 100%;">
  		 <div class="row"style="width: 100%;height: 100%;">
    <div class="col" style="width: 100%;height: 100%;	background-color: rgba(176,224,230,0.5);">
    	<h1 style="margin-top: 3%;color: #000000;background-color: rgba(176,224,230,0.7);">Calculate your footprint</h1>
    	    	<h4 style="margin-top: 3%;color: #000000;background-color: rgba(176,224,230,0.7);">step 1: Enter where are you going</h1>

    	<p >From:</p>
	<input type="text" name="address" id="from" value="current location" style="position: relative;
		width: 60%;" onclick="changevalue()" onmouseout="setvalue()"> 
		<br>

<p >To: </p>
<input  type="text" name="address" id="address" class="controls" style="width: 60%;">
<br>

<h4 style="margin-top: 3%;color: #000000;background-color: rgba(176,224,230,0.7);">step 2: Choose your travel mode</h1>
<input name="mode" type="radio" checked="checked" value="driving"/>driving
	</br>
	<input name="mode" type="radio" value="walking" />walking
	</br>
	<input name="mode" type="radio" value="bus" />bus
	</br>
	<input name="mode" type="radio" value="bike"/>bike

<div style="text-align: center;bottom: 0;">
	<input  type="submit" value="Submit" id="submit" >
	</div>
    </div>
    	

    <div class="col" style="width: 100%;height: 100%;">
  	<div class="container"style="width: 100%;height: 100%;">
  					<div id="map" class="map" style="display: none;"></div>
<div  style="width: 100%;height:100%;border: solid 1px;">
  		<img id="img" src="img/bicycle-bike-daylight-100582.jpg"style="width: 100%;height: 100%; ">
  		 <h4 id="result2"></h4>
  		   					<div id="graphic"></div>

  		</div>
    </div>
  </div>
  		</div>
  </section>
  <script>
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      var emission;
      var busemission;
      var map, infoWindow;
      var geocoder;
      var start;
      var end;
  
       var portals = document.getElementsByName("mode");
      function initMap() {
      	var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer;
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 10
        });
         var geocoder = new google.maps.Geocoder();

       

        infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            start = pos;
			var marker = new google.maps.Marker({
          	position: pos,
          	map: map,
          	title: 'Hello World!'
        }); 
        		infoWindow.open(map);
            map.setCenter(pos);
           	directionsDisplay.setMap(map);
           	document.getElementById('submit').addEventListener('click', function() {
        	  calculateAndDisplayRoute(directionsService, directionsDisplay);
        });

          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
        
      }
      
      
   
       
       function calculateAndDisplayRoute(directionsService, directionsDisplay) {
       	var orgin = "";
       	if (document.getElementById("from").value == "current location"){
       		var orgin = start;
       	}else{
       		orgin = document.getElementById("from").value;
       		
       	}
        directionsService.route({
          origin: orgin,
          destination: document.getElementById('address').value,
          travelMode: 'DRIVING'
        }, function(response, status) {
          if (status === 'OK') {
            directionsDisplay.setDirections(response);
            var result = directionsDisplay.getDirections();
            var total1 = 0;
        		var myroute = result.routes[0];
        		for (var i = 0; i < myroute.legs.length; i++) {
         	 total1 += myroute.legs[i].distance.value;
        		}
       		    total1 = total1 / 1000;
       		    busemission = total1 * 50.9714;
       		    var car = total1 * 120.5;
       		    for(var i = 0; i < portals.length; i++) {
        if(portals[i].checked) {
            if(portals[i].value === "driving") {
       		    	emission = 120.5 * total1;
            }
            else if(portals[i].value === "bus") {
       		    emission = total1 * 50.9714;
            }
            else  {
       		    emission = 0;
            }
        }
    }
    		    
           document.getElementById("result2").innerHTML = "your carbon emission: " + (0 | emission) + " grams";
            document.getElementById("img").style.display = "none";
            document.getElementById("result2").style.display = "inline";
             var data = [{
                "name": "car",
                "value": (0|car),
                "ixx": "./img/3.png"
        ,},
            {
                "name": "bus",
                "value": (0|busemission),
                "ixx": "./img/4.png"
        ,},
            {
                "name": "bicycle",
                "value": 0,
                "ixx": "./img/2.png"
        ,},
            {
                "name": "walk",
                "value": 0,
                "ixx": "./img/1.png"
        ,}];

        //sort bars based on value
        data = data.sort(function (a, b) {
            return d3.ascending(a.value, b.value);
        })

        //set up svg using margin conventions - we'll need plenty of room on the left for labels
        var margin = {
            top: 15,
            right: 125,
            bottom: 15,
            left: 60
        };

        var width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;
		document.getElementById('graphic').innerHTML = '';
        var svg = d3.select("#graphic").append("svg")
            .attr("preserveAspectRatio","xMidYMid meet")
            .attr("viewBox","24 -75 1040 1040")
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scale.linear()
            .range([0, width])
            .domain([0, d3.max(data, function (d) {
                return d.value;
            })]);

        var y = d3.scale.ordinal()
            .rangeRoundBands([height, 0], .1)
            .domain(data.map(function (d) {
                return d.name;
            }));

        //make y axis to show bar names
        var yAxis = d3.svg.axis()
            .scale(y)
            //no tick marks
            .tickSize(0)
            .orient("left");

        var gy = svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)

        var bars = svg.selectAll(".bar")
            .data(data)
            .enter()
            .append("g")

        //append rects
        bars.append("rect")
        
            .attr("class", "bar")
            .attr("y", function (d) {
                return y(d.name);
            })
            .attr("height", y.rangeBand())
            .attr("x", 0)
            .attr("width", function (d) {
                return x(d.value);
            });

        //add a value label to the right of each bar
        bars.append("text")
        		.style("font-size","30px")
            .attr("class", "label")
            //y position of the label is halfway down the bar
            .attr("y", function (d) {
                return y(d.name) + y.rangeBand() / 2 + 4;
            })
            //x position is 3 pixels to the right of the bar
            .attr("x", function (d) {
                return x(d.value) + 10;
            })
            .text(function (d) {
                return d.value;
            });
        
          
        

  		  bars.append("svg:image")
    			.attr("class", "svg-image")
    			.attr("y", function (d) {
                return y(d.name) + y.rangeBand() / 2 -28;
            })
            //x position is 3 pixels to the right of the bar
            .attr("x", function (d) {
                return x(d.value) + 38;
            })
    			.attr("height", "100px")
    			.attr("width", "100px")
      		.attr("xlink:href",function (d) {
                return d.ixx;
            })
          } else {
            window.alert('can not find the address you entered ');
          }
        });
 
       }
       
       
       function changevalue(){
       document.getElementById("from").value = "";
       }
      
       function setvalue(){
       	if (document.getElementById("from").value == ""){
       document.getElementById("from").value = "current location";
       }
       }
       
        function initAutocomplete() {
        	
        	
        }
       
        
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBVLIu5YPn5cZXXGKqmyirL1-08uyh_WM&callback=initMap">
    </script>
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="vendor/scrollreveal/scrollreveal.min.js"></script>
    <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

    <!-- Custom scripts for this template -->


    </script>
        <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false&libraries=geometry"></script>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBVLIu5YPn5cZXXGKqmyirL1-08uyh_WM&callback=initMap">
    </script>
<div class="newfooter">
	<p style="margin-left: 45%;">© 2018 Eco Melbourne</p>
</div>
  </body>

</html>
